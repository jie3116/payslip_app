<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Admin - Slip Gaji</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background-color: #f8f9fa;
      color: #333;
    }

    header {
      margin-bottom: 20px;
    }

    h2 {
      font-size: 24px;
      color: #2c3e50;
    }

    form,
    .action-bar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    select,
    input[type="text"],
    button {
      padding: 8px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    input[type="text"] {
      flex-grow: 1;
      min-width: 200px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }

    th,
    td {
      padding: 10px 12px;
      border: 1px solid #ddd;
      font-size: 14px;
      text-align: left;
    }

    th {
      background-color: #e9ecef;
    }

    .btn {
      padding: 6px 12px;
      font-size: 13px;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s ease;
    }

    .btn-download {
      background-color: #007bff;
    }

    .btn-kirim {
      background-color: #28a745;
    }

    .btn-action {
      background-color: #e67e22;
      font-weight: bold;
    }

    .btn-upload {
      background-color: #3498db;
    }

    .status-belum {
      color: #e74c3c;
    }

    .status-sudah {
      color: #27ae60;
    }

    @media (max-width: 600px) {
      .form-inline, .action-bar {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>

  <header>
    <h2>üìÑ Dashboard Admin - Slip Gaji Pegawai</h2>
  </header>

  <!-- üîÑ Form Filter -->
  <section>
    <form method="get" action="{{ url_for('admin_dashboard') }}">
      <label for="bulan">Bulan:</label>
      <select name="bulan" id="bulan">
        {% for b in ['01','02','03','04','05','06','07','08','09','10','11','12'] %}
          <option value="{{ b }}" {% if bulan == b %}selected{% endif %}>{{ b }}</option>
        {% endfor %}
      </select>

      <label for="tahun">Tahun:</label>
      <select name="tahun" id="tahun">
        {% for t in ['2025', '2026'] %}
          <option value="{{ t }}" {% if tahun == t %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
      </select>

      <button type="submit" class="btn btn-action">üîç Lihat Slip</button>
    </form>
  </section>

  <!-- üß∞ Action Bar -->
  <section class="action-bar">
    {% if slips %}
      <a href="{{ url_for('sendall', bulan=bulan, tahun=tahun) }}" class="btn btn-action">üöÄ Kirim Semua Slip Gaji</a>
    {% endif %}
    <a href="{{ url_for('upload_excel') }}" class="btn btn-upload">üìÅ Upload Data Gaji (.xlsx)</a>
    <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="üîé Cari Nama, Email, NUP..." />
  </section>

  <!-- üìä Table -->
  {% if slips %}
    <main>
      <table id="slipTable">
        <thead>
          <tr>
            <th>NUP</th>
            <th>Nama</th>
            <th>Email</th>
            <th>Bulan</th>
            <th>Tahun</th>
            <th>Slip</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          {% for s in slips %}
          <tr>
            <td>{{ s.nup }}</td>
            <td>{{ s.nama }}</td>
            <td>{{ s.email }}</td>
            <td>{{ s.bulan }}</td>
            <td>{{ s.tahun }}</td>
            <td>
              {% if s.file_path %}
                <a href="{{ url_for('admin_download', nup=s.nup, bulan=s.bulan, tahun=s.tahun) }}" class="btn btn-download" target="_blank">Download</a>
              {% else %}
                ‚ùå
              {% endif %}
            </td>
            <td>
              {% if s.status_kirim == 'Sudah' %}
                <span class="status-sudah">‚úÖ Sudah</span>
              {% else %}
                <span class="status-belum">‚ùå Belum</span>
              {% endif %}
            </td>
            <td>
              <a href="{{ url_for('send_email_by_admin', nup=s.nup, bulan=s.bulan, tahun=s.tahun) }}" class="btn btn-kirim">Kirim</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </main>
  {% else %}
    <p>‚ö†Ô∏è Tidak ada data slip gaji untuk periode ini.</p>
  {% endif %}

  <script>
    function searchTable() {
      const input = document.getElementById("searchInput").value.toLowerCase();
      const rows = document.querySelectorAll("#slipTable tbody tr");

      rows.forEach(row => {
        const cells = Array.from(row.getElementsByTagName("td"));
        const match = cells.some(cell => cell.textContent.toLowerCase().includes(input));
        row.style.display = match ? "" : "none";
      });
    }
  </script>

</body>
</html>
